# 用户管理功能设计文档

## 概述

为AMS-AI系统添加完整的用户管理功能，支持创建、查询、编辑、删除用户，以及角色分配和状态管理。

## 需求

1. **完整CRUD功能**：创建/查询/编辑/删除用户
2. **角色分配**：在创建/编辑弹窗内选择角色
3. **密码处理**：管理员设置临时密码
4. **状态管理**：简单启用/禁用切换
5. **搜索过滤**：支持用户名、邮箱、状态搜索

## 后端API设计

### 端点列表

| 方法 | 路径 | 功能 |
|------|------|------|
| GET | `/api/system/users` | 分页查询用户列表 |
| GET | `/api/system/users/{id}` | 获取单个用户详情 |
| POST | `/api/system/users` | 创建用户 |
| PUT | `/api/system/users/{id}` | 更新用户信息 |
| DELETE | `/api/system/users/{id}` | 删除用户 |
| PUT | `/api/system/users/{id}/status` | 启用/禁用用户 |
| PUT | `/api/system/users/{id}/reset-password` | 重置用户密码 |

### 请求/响应示例

**创建用户请求：**
```json
{
  "username": "zhangsan",
  "email": "zhangsan@example.com",
  "password": "Temp@123",
  "roleIds": [2, 3],
  "status": "ACTIVE"
}
```

**用户响应（不返回密码）：**
```json
{
  "id": 1,
  "username": "zhangsan",
  "email": "zhangsan@example.com",
  "status": "ACTIVE",
  "roles": [
    {"id": 2, "code": "OPERATOR", "name": "操作员"},
    {"id": 3, "code": "VIEWER", "name": "查看者"}
  ],
  "createdAt": "2026-02-23T10:00:00Z"
}
```

**查询参数：**
- `page`: 页码（默认0）
- `size`: 每页数量（默认20）
- `username`: 用户名模糊搜索
- `email`: 邮箱模糊搜索
- `status`: 状态过滤（ACTIVE/INACTIVE）

## 前端页面设计

### 页面布局

```
┌─────────────────────────────────────────────────────────────┐
│  用户管理                                    [刷新]         │
├─────────────────────────────────────────────────────────────┤
│  [新增用户]                                                  │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 用户名 [________] 邮箱 [________] 状态 [全部 ▼] [搜索] ││
│  └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│  用户名    │ 邮箱          │ 状态 │ 角色       │ 操作      │
│  admin    │ admin@xx.com  │ 启用 │ 管理员     │ [编辑][禁用]│
│  zhangsan │ zhang@xx.com  │ 启用 │ 操作员     │ [编辑][禁用]│
│  lisi     │ li@xx.com     │ 禁用 │ 查看者     │ [编辑][启用]│
└─────────────────────────────────────────────────────────────┘
```

### 新增/编辑弹窗字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 用户名 | Input | 是 | 唯一，字母数字 |
| 邮箱 | Input | 否 | 邮箱格式验证 |
| 密码 | Input.Password | 创建时必填 | 仅创建时显示 |
| 角色 | Select(多选) | 否 | 从角色列表选择 |
| 状态 | Radio | 是 | 启用/禁用 |

### 特殊逻辑

- 编辑时不显示密码字段，重置密码使用单独按钮
- 删除前需确认
- 当前登录用户不能禁用/删除自己

## 数据与安全

### 数据库

- User表已存在，无需新增表
- 用户-角色关联通过`user_roles`表（已有）
- 密码使用BCrypt加密存储

### 多租户过滤

- 所有查询必须添加`tenant_id`过滤
- 参考实现：`find("tenant", tenantId)`

### 安全控制

- 用户管理权限码：`admin:users`
- 防止操作自身账户（禁用/删除）
- 密码复杂度要求：至少8位，含大小写字母和数字

## 实施文件清单

| 类型 | 文件 | 操作 |
|------|------|------|
| 后端 | `feature-admin/.../UserService.java` | 新建 |
| 后端 | `feature-admin/.../UserController.java` | 扩展 |
| 后端 | `lib-persistence/.../User.java` | 扩展Repo |
| 前端 | `app-web/src/pages/admin/user-management.tsx` | 新建 |
| 前端 | `app-web/src/utils/api.ts` | 添加User API |
| 前端 | `app-web/src/Router.tsx` | 添加路由 |
| 菜单 | Liquibase迁移 | 添加菜单项 |
