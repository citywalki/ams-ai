# Dashboard 页面重构设计（混合看板）

## 1. 背景与目标

当前 `DashboardPage` 仅包含欢迎信息与 `/api/alerts` 基础加载提示，缺少可直接支撑运维与值班决策的总览能力。

本次重构目标：

- 将页面升级为“业务告警 + 系统状态”的混合看板
- 采用组件化结构，避免页面层堆叠业务逻辑
- 采用分阶段落地：先接入可用真实数据，再补齐系统指标后端
- 仅对告警相关指标提供跳转，避免无效导航

## 2. 范围与非范围

### 范围

- 重构 `DashboardPage` 页面结构与样式
- 拆分仪表盘展示组件与数据聚合 hook
- 基于现有 `/api/alerts` 计算告警类 KPI 和趋势
- 新增系统类 KPI 占位卡（标识“待接入”）
- 增加局部错误态与重试能力

### 非范围

- 本次不新增后端系统指标接口
- 本次不做实时推送（WebSocket/SSE）
- 本次不实现复杂图表库（优先轻量可维护方案）

## 3. 方案选型与取舍

共评估 3 种方案：

1. 页面内集中实现（快但难维护）
2. 组件化分层实现（可扩展，推荐）
3. 完全配置驱动（灵活但首期复杂度高）

最终采用方案 2：

- 页面负责编排，数据逻辑集中在 hook
- 展示组件纯 UI，便于后续替换系统指标数据源

## 4. 信息架构

页面分为四个区块：

1. 顶部总览区
   - 标题、说明、数据更新时间

2. KPI 网格区
   - 告警类（真实）：告警总数、处理中告警、高危告警
   - 系统类（占位）：API 可用性、近 24h 系统错误、平均响应耗时

3. 分析区
   - 告警趋势（近 7 天）
   - 系统健康面板（占位状态 + 接入说明）

4. 快捷区
   - 常用入口与操作提示（可选）

## 5. 数据流与分阶段策略

### 5.1 统一前端模型

新增 `DashboardMetrics` 视图模型，建议结构：

- `alertKpis`
- `systemKpis`
- `alertTrend`
- `updatedAt`

页面仅消费该模型，不直接依赖后端原始字段。

### 5.2 阶段 1（本次）

- 通过 `/api/alerts` 聚合告警类 KPI 与趋势
- 系统类 KPI 返回占位值（`--`）并标注“待接入”
- 保证页面可交付、可扩展

### 5.3 阶段 2（后续）

- 后端新增统一系统指标接口（建议 `/api/system/metrics`）
- hook 层替换系统指标来源
- 页面与组件结构保持不变

## 6. 交互设计

### 6.1 跳转规则

仅告警类 KPI 可跳转：

- 告警总数 → `/alerts`
- 处理中告警 → `/alerts?status=PROCESSING`
- 高危告警 → `/alerts?severity=HIGH`

系统类 KPI 不提供跳转。

### 6.2 状态反馈

- 告警数据加载中：显示局部 loading
- 告警数据失败：显示局部错误提示 + 重试按钮
- 系统区占位失败不影响告警区渲染

### 6.3 响应式

- 桌面端：KPI 三列
- 平板端：KPI 两列
- 手机端：KPI 一列

保持在 `MainLayout` 容器中无横向滚动。

## 7. 组件边界

建议拆分：

- `DashboardPage`：页面布局编排
- `useDashboardMetrics`：数据请求与聚合
- `DashboardKpiCard`：统一 KPI 卡片
- `AlertTrendPanel`：告警趋势展示
- `SystemHealthPanel`：系统健康占位与说明

组件职责清晰，便于后续增量迭代。

## 8. 验收标准

1. 页面显示混合看板，含 3 个真实告警指标与 2~3 个系统占位指标
2. 仅告警类卡片可点击并跳转到正确路由参数
3. `/api/alerts` 异常时页面不崩溃，支持局部重试
4. 三档响应式布局正常（桌面/平板/手机）
5. TypeScript 编译通过，`pnpm build` 可完成

## 9. 风险与回归点

- 风险1：告警字段枚举与前端统计口径不一致
  - 规避：在 hook 层统一映射状态/严重级别

- 风险2：占位指标视觉与真实指标混淆
  - 规避：占位卡明确显示“待接入”标签和说明

- 风险3：跳转参数与告警列表筛选字段不匹配
  - 规避：与现有 alerts 页面参数约定对齐并验证
